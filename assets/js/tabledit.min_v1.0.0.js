/*!
 * Tabledit v1.0.0 (https://github.com/markcell/jQuery-Tabledit)
 * Copyright (c) 2015 Celso Marques
 * Licensed under MIT (https://github.com/markcell/jQuery-Tabledit/blob/master/LICENSE)
 */
if(typeof jQuery==="undefined"){throw new Error("Tabledit requires jQuery library.")}(function(a){a.fn.Tabledit=function(c){if(!this.is("table")){throw new Error("Tabledit only works when applied to a table.")}var b=this;var e=a.extend({url:window.location.href,inputClass:"form-control input-sm",eventType:"click",hideIdentifier:false,textSelection:true,onDraw:function(){return},onComplete:function(){return},onError:function(){return}},c);var f={view:function(i){a(i).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",true);a(i).find(".tabledit-input").blur().hide().prop("disabled",true);a(i).find(".tabledit-span").show();a(i).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode")},edit:function(i){a(i).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",false);a(i).find(".tabledit-span").hide();a(i).find(".tabledit-input").prop("disabled",false).show().focus();a(i).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode")}};var d={reset:function(i){a(i).find(".tabledit-input").val(a(i).find(".tabledit-span").text());f.view(i)},submit:function(j){g("edit");var i=a(j).find(".tabledit-input");if(i.is("select")){a(j).find(".tabledit-span").text(i.find("option:selected").text())}else{a(j).find(".tabledit-span").text(i.val())}f.view(j)}};var h={form:function(i){if(!b.parent("form.tabledit-form").length>0){b.wrap('<form action="'+i+'" method="post" class="tabledit-form"></form>')}},columns:{identifier:function(){if(e.hideIdentifier){b.find("th:nth-child("+parseInt(e.columns.identifier[0])+1+"), td:nth-child("+parseInt(e.columns.identifier[0])+1+")").hide()}var i=b.find("td:nth-child("+(parseInt(e.columns.identifier[0])+1)+")");i.each(function(){var k='<span class="tabledit-span tabledit-identifier">'+a(this).text()+"</span>";var j='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+e.columns.identifier[1]+'" value="'+a(this).text()+'" disabled>';a(this).html(k+j)})},editable:function(){for(var j=0;j<e.columns.editable.length;j++){var k=b.find("td:nth-child("+(parseInt(e.columns.editable[j][0])+1)+")");k.each(function(){a(this).css("cursor","pointer");var l='<span class="tabledit-span">'+a(this).text()+"</span>";if(typeof e.columns.editable[j][2]!=="undefined"){var i='<select class="tabledit-input '+e.inputClass+'" name="'+e.columns.editable[j][1]+'" style="display: none;" disabled>';a.each(jQuery.parseJSON(e.columns.editable[j][2]),function(m,n){i+='<option value="'+m+'">'+n+"</option>"});i+="</select>"}else{var i='<input class="tabledit-input '+e.inputClass+'" type="text" name="'+e.columns.editable[j][1]+'" value="'+a(this).text()+'" style="display: none;" disabled>'}a(this).html(l+i);a(this).addClass("tabledit-view-mode")})}if(!e.textSelection){b.find("td.tabledit-view-mode").css("-webkit-touch-callout","none").css("-webkit-user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-ms-user-select","none").css("user-select","none")}}}};h.form(e.url);h.columns.identifier();h.columns.editable();e.onDraw();b.on(e.eventType,"td.tabledit-view-mode",function(i){i.preventDefault();d.reset(b.find("td.tabledit-edit-mode"));f.edit(this)});b.on("change","select.tabledit-input:visible",function(){d.submit(a(this).parent("td"))});a(document).on("click",function(j){var i=b.find(".tabledit-edit-mode");if(!i.is(j.target)&&i.has(j.target).length===0){d.reset(b.find(".tabledit-input:visible").parent("td"))}});a(document).on("keyup",function(i){var k=b.find(".tabledit-input:focus");if(k.length>0){var j=k.parent(".tabledit-edit-mode");if(i.keyCode===13){d.submit(j)}if(i.keyCode===27){d.reset(j)}}});function g(j){var i="&action="+j;return a.post(e.url,a("form.tabledit-form").serialize()+i,function(k){e.onComplete(k)},"json").fail(function(){e.onError()})}}}(jQuery));