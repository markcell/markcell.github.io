/*!
 * Tabledit v1.1.0 (https://github.com/markcell/jQuery-Tabledit)
 * Copyright (c) 2015 Celso Marques
 * Licensed under MIT (https://github.com/markcell/jQuery-Tabledit/blob/master/LICENSE)
 */
if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");!function(t){"use strict";t.fn.Tabledit=function(e){function n(e){var n="&action="+e,i=t.post(a.url,t("form.tabledit-form").serialize()+n,function(t,n,i){"edit"===e&&(d.removeClass(a.dangerClass).addClass(a.warningClass),setTimeout(function(){d.removeClass(a.warningClass)},1400)),a.onSuccess(t,n,i)},"json");return i.fail(function(t,n,i){"remove"===e?(l.removeClass(a.mutedClass).addClass(a.dangerClass),l.find(".tabledit-toolbox button").attr("disabled",!1)):"edit"===e&&d.addClass(a.dangerClass),a.onFail(t,n,i)}),i.always(function(){a.onAlways()}),i}if(!this.is("table"))throw new Error("Tabledit only works when applied to a table.");var i=this,s={url:window.location.href,inputClass:"form-control input-sm",dangerClass:"danger",warningClass:"warning",mutedClass:"text-muted",eventType:"click",confirmText:" &nbsp; Confirm",hideIdentifier:!1,textSelection:!0,editButton:!0,removeButton:!0,buttons:{edit:{"class":"btn btn-sm btn-warning",html:'<span class="glyphicon glyphicon-pencil"></span>'},remove:{"class":"btn btn-sm btn-danger",html:'<span class="glyphicon glyphicon-trash"></span>'},save:{"class":"btn btn-sm btn-success",html:'<span class="glyphicon glyphicon-ok"></span> &nbsp; Save'},cancel:{"class":"btn btn-sm btn-warning",html:'<span class="glyphicon glyphicon-pencil"></span>'}},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){}},a=t.extend({},s,e),d="undefined",l="undefined",o={form:function(t){!i.parent("form.tabledit-form").length>0&&i.wrap('<form action="'+t+'" method="post" class="tabledit-form"></form>')},columns:{identifier:function(){a.hideIdentifier&&i.find("th:nth-child("+parseInt(a.columns.identifier[0])+"1), td:nth-child("+parseInt(a.columns.identifier[0])+"1)").hide();var e=i.find("td:nth-child("+(parseInt(a.columns.identifier[0])+1)+")");e.each(function(){var e='<span class="tabledit-span tabledit-identifier">'+t(this).text()+"</span>",n='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+a.columns.identifier[1]+'" value="'+t(this).text()+'" disabled>';t(this).html(e+n),t(this).parent("tr").attr("id",t(this).text())})},editable:function(){for(var e=0;e<a.columns.editable.length;e++){var n=i.find("td:nth-child("+(parseInt(a.columns.editable[e][0])+1)+")");n.each(function(){a.editButton||t(this).css("cursor","pointer");var n='<span class="tabledit-span">'+t(this).text()+"</span>";if("undefined"!=typeof a.columns.editable[e][2]){var i='<select class="tabledit-input '+a.inputClass+'" name="'+a.columns.editable[e][1]+'" style="display: none;" disabled>';t.each(jQuery.parseJSON(a.columns.editable[e][2]),function(t,e){i+='<option value="'+t+'">'+e+"</option>"}),i+="</select>"}else var i='<input class="tabledit-input '+a.inputClass+'" type="text" name="'+a.columns.editable[e][1]+'" value="'+t(this).text()+'" style="display: none;" disabled>';t(this).html(n+i),t(this).addClass("tabledit-view-mode")})}a.textSelection||i.find("td.tabledit-view-mode").css("-webkit-touch-callout","none").css("-webkit-user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-ms-user-select","none").css("user-select","none")},toolbox:function(){if(a.editButton||a.removeButton){var t="",e="",n="",s="";0===i.find("th.tabledit-toolbox-column").length&&i.find("tr:first").append('<th class="tabledit-toolbox-column"></th>'),a.buttons.edit["class"]===a.buttons.cancel["class"]&&a.buttons.edit.html===a.buttons.cancel.html&&(a.buttons.cancel["class"]+=" active"),a.editButton&&(t='<button type="button" class="tabledit-edit-button '+a.buttons.edit["class"]+'" style="margin-left: 5px;">'+a.buttons.edit.html+"</button>",n='<button type="button" class="tabledit-save-button '+a.buttons.save["class"]+'" style="margin-left: 5px; display: none;">'+a.buttons.save.html+"</button>",s='<button type="button" class="tabledit-cancel-button '+a.buttons.cancel["class"]+'" style="margin-left: 5px; display: none;">'+a.buttons.cancel.html+"</button>"),a.removeButton&&(e='<button type="button" class="tabledit-remove-button '+a.buttons.remove["class"]+'" style="margin-left: 5px;">'+a.buttons.remove.html+"</button>"),i.find("tr:gt(0)").append('<td style="white-space: nowrap; width: 1px;"><div class="tabledit-toolbox" style="margin-left: -5px; text-align: right;">'+t+n+s+e+"</div></td>")}}}},r={view:function(e){var n=t(e).parent("tr");t(e).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),t(e).find(".tabledit-input").blur().hide().prop("disabled",!0),t(e).find(".tabledit-span").show(),t(e).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),a.editButton&&(n.find("button.tabledit-save-button, button.tabledit-cancel-button").hide(),n.find("button.tabledit-edit-button").show())},edit:function(e){c.reset();var n=t(e).parent("tr");n.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),t(e).find(".tabledit-span").hide(),t(e).find(".tabledit-input").prop("disabled",!1).show().focus(),t(e).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),a.editButton&&(n.find("button.tabledit-edit-button").hide(),n.find("button.tabledit-save-button, button.tabledit-cancel-button").show())}},u={reset:function(e){t(e).each(function(){var e=t(this).find(".tabledit-input");e.is("select")?e.find('option[text="'+t(this).find(".tabledit-span").text()+'"]').attr("selected",!0):e.val(t(this).find(".tabledit-span").text()),r.view(this)})},submit:function(e){n("edit"),t(e).each(function(){var e=t(this).find(".tabledit-input");t(this).find(".tabledit-span").text(e.is("select")?e.find("option:selected").text():e.val()),r.view(this)}),d=t(e).parent("tr")}},c={reset:function(){i.find(".tabledit-remove-button.tabledit-confirm").removeClass("tabledit-confirm").find("span.tabledit-confirm-text").remove()},submit:function(e){c.reset(),t(e).parents("tr").find("input.tabledit-identifier").attr("disabled",!1),n("remove"),t(e).parents("tr").addClass(a.mutedClass).find(".tabledit-toolbox button").attr("disabled",!0),t(e).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),l=t(e).parents("tr")},confirm:function(e){r.view(t(e).parents("tr").find("td.tabledit-edit-mode")),t(e).html(a.buttons.remove.html+'<span class="tabledit-confirm-text">'+a.confirmText+"</span>").addClass("tabledit-confirm").blur()}};return o.form(a.url),o.columns.identifier(),o.columns.editable(),o.columns.toolbox(),a.onDraw(),a.removeButton&&i.on("click","button.tabledit-remove-button",function(e){e.handled!==!0&&(e.preventDefault(),t(this).hasClass("tabledit-confirm")?c.submit(this):(c.reset(),c.confirm(this)),e.handled=!0)}),a.editButton?(i.on("click","button.tabledit-edit-button",function(e){e.handled!==!0&&(e.preventDefault(),u.reset(i.find("td.tabledit-edit-mode")),t(t(this).parents("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){r.edit(this)}),e.handled=!0)}),i.on("click","button.tabledit-save-button",function(e){e.handled!==!0&&(e.preventDefault(),u.submit(t(this).parents("tr").find("td.tabledit-edit-mode")),e.handled=!0)}),i.on("click","button.tabledit-cancel-button",function(e){e.handled!==!0&&(e.preventDefault(),u.reset(t(this).parents("tr").find("td.tabledit-edit-mode")),e.handled=!0)})):(i.on(a.eventType,"td.tabledit-view-mode",function(t){t.handled!==!0&&(t.preventDefault(),u.reset(i.find("td.tabledit-edit-mode")),r.edit(this),t.handled=!0)}),i.on("change","select.tabledit-input:visible",function(){event.handled!==!0&&(u.submit(t(this).parent("td")),event.handled=!0)}),t(document).on("click",function(t){var e=i.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||u.reset(i.find(".tabledit-input:visible").parent("td"))})),t(document).on("keyup",function(t){var e=i.find(".tabledit-input:focus"),n=i.find(".tabledit-remove-button.tabledit-confirm");if(e.length>0||n.length>0){if(a.editButton)var s=e.parents("tr").find(".tabledit-edit-mode");else var s=e.parent(".tabledit-edit-mode");switch(t.keyCode){case 13:u.submit(s);break;case 27:u.reset(s),c.reset()}}}),this}}(jQuery);